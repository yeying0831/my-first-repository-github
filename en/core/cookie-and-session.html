<!DOCTYPE html>
<html lang="en">
<head>
  <title>Cookie and Session - Born to build better enterprise frameworks and apps</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/css/index.css">

    <script>
    !function(t,e,a,r,c){t.TracertCmdCache=t.TracertCmdCache||[],t[c]=window[c]||
      {_isInit:!0,call:function(){t.TracertCmdCache.push(arguments)},
      start:function(t){this.call('start',t)}},t[c].l=new Date;
      var n=e.createElement(a),s=e.getElementsByTagName(a)[0];
      n.async=!0,n.src=r,s.parentNode.insertBefore(n,s)}
    (window,document,'script','https://tracert.alipay.com/tracert.js','Tracert');
      Tracert.start({
        plugins: [ 'BucName' ],
        spmAPos: 'a454',
        spmBPos: 'b4893',
      });
    </script>
  
</head>
<body>
  <div class="nav" >
  <header>
    <a href="/en/" class="nav-logo leftpadding" alt="egg"><img src="https://zos.alipayobjects.com/rmsportal/VTcUYAaoKqXyHJbLAPyF.svg"></a>
    <ul class="nav-item">
      <li>
        <form id="search-form">
          <input type="text" id="search-query" class="search-query st-default-search-input">
        </form>
      </li>
      <li><a href="/en/intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="/en/tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li>
      
      
        <li class="translations">
          <a class="nav-link">Translations</a>
          <span class="arrow"></span><ul id="dropdownContent" class="dropdown-content"><li><a id="zh-cn" href="/zh-cn/core/cookie-and-session.html" >中文</a></li><li><a id="en" href="/en/core/cookie-and-session.html" style="color: #22ab28">English</a></li></ul>
        </li>
      
      <li><iframe src="https://ghbtns.com/github-btn.html?user=eggjs&repo=egg&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>
  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>Cookie and Session</h1>
    <h2 id="cookie"><a class="markdown-anchor" href="#cookie">#</a> Cookie</h2>
<p>HTTP is a stateless protocol.
But web applications often need to identify the sender of requests.
To solve this problem, HTTP protocol defines a header <a href="https://en.wikipedia.org/wiki/HTTP_cookie" target="_blank" rel="noopener">Cookie</a>.
Web servers can use response header <code>Set-Cookie</code> to send small data to clients.
Clients (e.g. web browsers) store the data according to protocol,
and attach the cookie data in future requests.
For security reason, browsers only attach cookies in the requests that are sent to the same domain.
Web servers can use <code>Domain</code> and <code>Path</code> attributes to define the scope of the cookie.</p>
<p>By using <code>ctx.cookies</code>, we can easily and safely read/set cookies in controller.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> add() &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span>.ctx;</span><br><span class="line">    <span class="keyword">let</span> count = ctx.cookies.get(<span class="string">'count'</span>);</span><br><span class="line">    count = count ? <span class="built_in">Number</span>(count) : <span class="number">0</span>;</span><br><span class="line">    ctx.cookies.set(<span class="string">'count'</span>, ++count);</span><br><span class="line">    ctx.body = count;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">async</span> remove() &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span>.ctx;</span><br><span class="line">    ctx.cookies.set(<span class="string">'count'</span>, <span class="literal">null</span>);</span><br><span class="line">    ctx.status = <span class="number">204</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ctxcookiessetkey-value-options"><a class="markdown-anchor" href="#ctxcookiessetkey-value-options">#</a> <code>ctx.cookies.set(key, value, options)</code></h4>
<p>Modifying Cookie is done by setting <code>Set-Cookie</code> header in HTTP responses.
Each <code>Set-Cookie</code> creates a key-value pair in client.
Besides of setting the value of Cookie,
HTTP protocol supports more attributes to control the transfer, storage and permission of Cookie.</p>
<ul>
<li><code>{Number} maxAge</code>: set the lifetime of the cookie in milliseconds. It's the milliseconds since server's &quot;Now&quot;. Client discards a cookie after specified lifetime.</li>
<li><code>{Date} expires</code>: set the expiration time of the cookie. If <code>maxAge</code> is defined, <code>expires</code> will be ignored. If neither is defined, Cookie will expire when client session expires, usually it's the time client closed.</li>
<li><code>{String} path</code>: set the path of the cookie. By default it's on root path (<code>/</code>), which means all URL under the current domain have access to the cookie.</li>
<li><code>{String} domain</code>: set the domain of the cookie. By default, it's not defined. If defined, only specified domain have access to the cookie.</li>
<li><code>{Boolean} httpOnly</code>: set whether the cookie can be accessed by Javascript. By default it's <code>true</code>, which means Javascript cannot access the cookie.</li>
<li><code>{Boolean} secure</code>: set whether the cookie can only be accessed under HTTPS. See <a href="http://stackoverflow.com/questions/13729749/how-does-cookie-secure-flag-work" target="_blank" rel="noopener">explanation</a> for details. Egg.js auto sets this value to true if the current request is sent over HTTPS.</li>
</ul>
<p>In addition to these standard Cookie attributes, egg.js supports 3 more parameters:</p>
<ul>
<li><code>{Boolean} overwrite</code>: set the way of handling same Cookie key. If true, earlier called values will be overwritten by the last call; otherwise HTTP response will contain multiple <code>Set-Cookie</code> headers with the same key.</li>
<li><code>{Boolean} signed</code>: set whether the cookie should be signed. If true, the value of the cookie will be signed. So that when the value is being read, server verifies the signature to prevent cookie values modified by client. By default it's true.</li>
<li><code>{Boolean} encrypt</code>: set whether the cookie should be encrypted. It true, the cookie value will be encrypted before sending to clients so user clients cannot get raw text of the cookie. By default it's false.</li>
</ul>
<p>When using Cookie, we need to have a clear idea of the purpose of the cookie,
how long it needs to be stored in client, can it be accessed by JS, can it be modified by client.</p>
<p><strong>By default, Cookie is signed but not encrypted,
client can see raw content but cannot modify it (manually).</strong></p>
<ul>
<li>If you need to allow JS to access and modify Cookie:</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ctx.cookies.set(key, value, &#123;</span><br><span class="line">  httpOnly: <span class="literal">false</span>,</span><br><span class="line">  signed: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>If you don't want to allow JS to access and modify Cookie:</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ctx.cookies.set(key, value, &#123;</span><br><span class="line">  httpOnly: <span class="literal">true</span>, <span class="comment">// by default it's true</span></span><br><span class="line">  encrypt: <span class="literal">true</span>, <span class="comment">// cookies are encrypted during network transmission</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Note:</p>
<ol>
<li>Due to <a href="http://stackoverflow.com/questions/7567154/can-i-use-unicode-characters-in-http-headers" target="_blank" rel="noopener">the uncertainty of client's implementation</a>, to ensure Cookie can be stored successfully, it's recommended to encode cookie value in base64 or other codec.</li>
<li>Due to <a href="http://stackoverflow.com/questions/640938/what-is-the-maximum-size-of-a-web-browsers-cookies-key" target="_blank" rel="noopener">the limitation of Cookie length on client side</a>, do avoid using long Cookie. Generally speaking, no more than 4093 bytes. When Cookie value's length is greater than this value, egg.js prints a warning in log.</li>
</ol>
<h4 id="ctxcookiesgetkey-options"><a class="markdown-anchor" href="#ctxcookiesgetkey-options">#</a> <code>ctx.cookies.get(key, options)</code></h4>
<p>As HTTP Cookie is sent over header,
we can use this method to easily retrieve the value of given key from Cookie.
If <code>options.signed</code> and <code>options.encrypt</code> has been configured to sign and encrypt Cookie,
the corresponding options also need to be used in <code>get</code> method.</p>
<ul>
<li>If <code>signed</code> is true when <code>set</code> Cookie but false when <code>get</code> Cookie, egg.js doesn't verify Cookie value, so the value could have been modified by client.</li>
<li>If <code>encrypt</code> is true when <code>set</code> Cookie but false when <code>get</code> Cookie, what you get is encrypted text rather than the raw plain text.</li>
</ul>
<h3 id="cookie-secret-key"><a class="markdown-anchor" href="#cookie-secret-key">#</a> Cookie Secret Key</h3>
<p>Since we need to sign and encrypt Cookie, a secret key is required.
In <code>config/config.default.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  keys: <span class="string">'key1,key2'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>keys</code> is defined as a string, several keys separated by commas.
When egg.js processes Cookie:</p>
<ul>
<li>the first key is used in encryption and signature generation.</li>
<li>to decrypt or verify signature, egg.js iterates through all keys.</li>
</ul>
<p>If you need to update Cookie secret key and don't want to invalidate existing clients' Cookie,
you can add new secret key at the front of <code>keys</code>.
After some time, when existing Cookie has expired, delete the old secret keys.</p>
<h2 id="session"><a class="markdown-anchor" href="#session">#</a> Session</h2>
<p>In web applications, Cookie is usually used to identify users.
So the concept of Session, which is built on top of Cookie,
was created to specifically handle user identification.</p>
<p>Egg.js built-in supports Session through <a href="https://github.com/eggjs/egg-session" target="_blank" rel="noopener">egg-session</a> plugin.
We can use <code>ctx.session</code> to read or modify current user session.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> fetchPosts() &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span>.ctx;</span><br><span class="line">    <span class="comment">// get content from session</span></span><br><span class="line">    <span class="keyword">const</span> userId = ctx.session.userId;</span><br><span class="line">    <span class="keyword">const</span> posts = <span class="keyword">await</span> ctx.service.post.fetch(userId);</span><br><span class="line">    <span class="comment">// modify session value</span></span><br><span class="line">    ctx.session.visited = ctx.session.visited ? ctx.session.visited++ : <span class="number">1</span>;</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      success: <span class="literal">true</span>,</span><br><span class="line">      posts,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It is very intuitive to use Session, simply get or set.
To delete a session, set its value to null:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">exports.deleteSession = <span class="function"><span class="keyword">function</span>* (<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">  ctx.session = <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Session is built on top of Cookie.
By default, the content of Session is stored in a Cookie field as encrypted string.
Every time a client sends requests to server, the cookie is attached in requests.
Egg.js passes decrypted cookie to server code.
The default configuration of Session is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">exports.session = &#123;</span><br><span class="line">  key: <span class="string">'EGG_SESS'</span>,</span><br><span class="line">  maxAge: <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>, <span class="comment">// 1 day</span></span><br><span class="line">  httpOnly: <span class="literal">true</span>,</span><br><span class="line">  encrypt: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The attributes except of <code>key</code> are all standard Cookie attributes.
<code>key</code> is the key of the cookie that stores session content.
With default config, the session cookie is encrypted, not accessible to JS,
which ensures user cannot access or modify it.</p>
<h3 id="store-session-in-other-storage"><a class="markdown-anchor" href="#store-session-in-other-storage">#</a> Store session in other storage</h3>
<p>Session is stored in Cookie by default.
If a session is too big, there are some troubles.</p>
<ul>
<li>as mentioned above, clients usually have limitation on Cookie length. When session is too big, a client may refuse to store it.</li>
<li>Cookie is attached in every request. If session is too big, the additional cost of sending session may be significant.</li>
</ul>
<p>Egg.js supports to store Session in other places.
To config it, you can simply set <code>app.sessionStore</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">  app.sessionStore = &#123;</span><br><span class="line">    <span class="comment">// support promise / async</span></span><br><span class="line">    <span class="keyword">async</span> get (key) &#123;</span><br><span class="line">      <span class="comment">// return value;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> set (key, value, maxAge) &#123;</span><br><span class="line">      <span class="comment">// set key to store</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> destroy (key) &#123;</span><br><span class="line">      <span class="comment">// destroy key</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The implementation of <code>sessionStore</code> can also be encapsulated into a plugin.
For example, <a href="https://github.com/eggjs/egg-session-redis" target="_blank" rel="noopener">egg-session-redis</a> stores Session in Redis.
To apply it, import <a href="https://github.com/eggjs/egg-redis" target="_blank" rel="noopener">egg-redis</a> and <a href="https://github.com/eggjs/egg-session-redis" target="_blank" rel="noopener">egg-session-redis</a> plugin in your application.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// plugin.js</span></span><br><span class="line">exports.redis = &#123;</span><br><span class="line">  enable: <span class="literal">true</span>,</span><br><span class="line">  package: <span class="string">'egg-redis'</span>,</span><br><span class="line">&#125;;</span><br><span class="line">exports.sessionRedis = &#123;</span><br><span class="line">  enable: <span class="literal">true</span>,</span><br><span class="line">  package: <span class="string">'egg-session-redis'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>Note: once you choose to store Session in external storage,
it means your system heavily depends on the external storage.
Once it's down, Session feature won't work.
So it's recommended to put only necessary information in Session,
keep Session minimum and use the default Cookie storage if possible.
Do not put per-user's data cache in Session.</strong></p>
<h3 id="session-practice"><a class="markdown-anchor" href="#session-practice">#</a> Session Practice</h3>
<h4 id="set-sessions-expiration-time"><a class="markdown-anchor" href="#set-sessions-expiration-time">#</a> Set session's expiration time</h4>
<p>Session config has a attribute <code>maxAge</code>, which controls global expiration time of all sessions of the application.</p>
<p>We often can see a <strong>Remember Me</strong> option on a lot of websites' login page.
If it's selected, Session of this logged in user can live longer.
This kind of per-user session expiration time can be set through <code>ctx.session.maxAge</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ms = <span class="built_in">require</span>(<span class="string">'ms'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> login() &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span>.ctx;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password, rememberMe &#125; = ctx.request.body;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> ctx.loginAndGetUser(username, password);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set Session</span></span><br><span class="line">    ctx.session.user = user;</span><br><span class="line">    <span class="comment">// if user selected `Remember Me`, set expiration time to 30 days</span></span><br><span class="line">    <span class="keyword">if</span> (rememberMe) ctx.session.maxAge = ms(<span class="string">'30d'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="extend-sessions-expiration-time"><a class="markdown-anchor" href="#extend-sessions-expiration-time">#</a> Extend session's expiration time</h4>
<p>By default, if user requests don't result in modification of Session,
egg.js doesn't extend expiration time of the session.
But in some scenarios, you may need to refresh expiration time every time user access the website,
so that users will only be logged out when they don't access website for long time.
This requirement can be done through <code>ctx.session.save()</code>.</p>
<p>For example, we create a middleware in the application.
It forces saving session in every request, in order to extend session's expiration time.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/middleware/save_session.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">saveSession</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">    <span class="comment">// if Session is empty, do nothing</span></span><br><span class="line">    <span class="keyword">if</span> (!ctx.session.populated) <span class="keyword">return</span>;</span><br><span class="line">    ctx.session.save();</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// config/config.default.js</span></span><br><span class="line"><span class="comment">// import the middleware in config file</span></span><br><span class="line">exports.middleware = [ <span class="string">'saveSession'</span> ];</span><br></pre></td></tr></table></figure>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul>
      <li><a href="/en/intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="/en/tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li>
      
      
        <li class="translations">
          <a class="nav-link">Translations</a>
          <span class="arrow"></span><ul id="dropdownContent" class="dropdown-content"><li><a id="zh-cn" href="/zh-cn/core/cookie-and-session.html" >中文</a></li><li><a id="en" href="/en/core/cookie-and-session.html" style="color: #22ab28">English</a></li></ul>
        </li>
      
    </ul>
  </div>
  <dl><dt id="title-Intro" style="cursor: pointer;" class="aside-title">Guide<a id="collapse-icon-Intro" class="icon opend"></a></dt><dd id=panel-Intro><ul><li><a href="/en/intro/index.html" class="menu-link">What is Egg?</a></li><li><a href="/en/intro/egg-and-koa.html" class="menu-link">Egg and Koa</a></li><li><a href="/en/intro/quickstart.html" class="menu-link">Quick Start</a></li><li><a href="/en/tutorials/progressive.html" class="menu-link">Progressive</a></li><li><a href="/en/migration.html" class="menu-link">Migration to 2.x</a></li></ul></dd><dt id="title-Basics" style="cursor: pointer;" class="aside-title">Basis Function<a id="collapse-icon-Basics" class="icon opend"></a></dt><dd id=panel-Basics><ul><li><a href="/en/basics/structure.html" class="menu-link">Directory Structure</a></li><li><a href="/en/basics/objects.html" class="menu-link">Built-in Objects</a></li><li><a href="/en/basics/env.html" class="menu-link">Environment</a></li><li><a href="/en/basics/config.html" class="menu-link">Configuration</a></li><li><a href="/en/basics/middleware.html" class="menu-link">Middleware</a></li><li><a href="/en/basics/router.html" class="menu-link">Router</a></li><li><a href="/en/basics/controller.html" class="menu-link">Controller</a></li><li><a href="/en/basics/service.html" class="menu-link">Service</a></li><li><a href="/en/basics/plugin.html" class="menu-link">Plugin</a></li><li><a href="/en/basics/schedule.html" class="menu-link">Schedule</a></li><li><a href="/en/basics/extend.html" class="menu-link">Extend</a></li><li><a href="/en/basics/app-start.html" class="menu-link">Custom Init</a></li></ul></dd><dt id="title-Core" style="cursor: pointer;" class="aside-title">Core<a id="collapse-icon-Core" class="icon opend"></a></dt><dd id=panel-Core><ul><li><a href="/en/core/development.html" class="menu-link">Development</a></li><li><a href="/en/core/unittest.html" class="menu-link">Unit Testing</a></li><li><a href="/en/core/deployment.html" class="menu-link">Deployment</a></li><li><a href="/en/core/logger.html" class="menu-link">Logger</a></li><li><a href="/en/core/httpclient.html" class="menu-link">HttpClient</a></li><li><a href="/en/core/cookie-and-session.html" class="menu-link">Cookie and Session</a></li><li><a href="/en/core/cluster-and-ipc.html" class="menu-link">Cluster and IPC</a></li><li><a href="/en/core/view.html" class="menu-link">View</a></li><li><a href="/en/core/error-handling.html" class="menu-link">Error Handling</a></li><li><a href="/en/core/security.html" class="menu-link">Security</a></li><li><a href="/en/core/i18n.html" class="menu-link">i18n</a></li></ul></dd><dt id="title-Tutorials" style="cursor: pointer;" class="aside-title">Tutorials<a id="collapse-icon-Tutorials" class="icon opend"></a></dt><dd id=panel-Tutorials><ul><li><a href="/en/tutorials/mysql.html" class="menu-link">MySQL</a></li><li><a href="/en/tutorials/restful.html" class="menu-link">RESTful API</a></li><li><a href="/en/tutorials/passport.html" class="menu-link">Passport</a></li><li><a href="/en/tutorials/socketio.html" class="menu-link">Socket.IO</a></li><li><a href="/en/tutorials/assets.html" class="menu-link">Assets</a></li></ul></dd><dt id="title-Advanced" style="cursor: pointer;" class="aside-title">Advanced<a id="collapse-icon-Advanced" class="icon opend"></a></dt><dd id=panel-Advanced><ul><li><a href="/en/advanced/loader.html" class="menu-link">Loader</a></li><li><a href="/en/advanced/plugin.html" class="menu-link">Plugin Development</a></li><li><a href="/en/advanced/framework.html" class="menu-link">Framework</a></li><li><a href="/en/advanced/cluster-client.html" class="menu-link">Cluster Enhancement</a></li><li><a href="/en/advanced/view-plugin.html" class="menu-link">View Plugin</a></li><li><a href="/en/style-guide.html" class="menu-link">Style Guide</a></li></ul></dd><dt id="title-Community" style="cursor: pointer;" class="aside-title">Community<a id="collapse-icon-Community" class="icon opend"></a></dt><dd id=panel-Community><ul><li><a href="/en/plugins/" class="menu-link">Plugin List</a></li><li><a href="/en/contributing.html" class="menu-link">Contributing</a></li><li><a href="/en/resource.html" class="menu-link">Resource</a></li><li><a href="/en/faq.html" class="menu-link">FAQ</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');

var expandMenu = function(title) {
  // handle icon
  const collapseIcon = document.getElementById('collapse-icon-' + title);
  if (collapseIcon) {
    collapseIcon.className = 'icon opend';
  }
  // handle panelEle
  const panelEle = document.getElementById('panel-' + title);
  if (panelEle) {
    panelEle.className = '';
  }
}

var collapseMenu = function(title) {
  // handle icon
  const collapseIcon = document.getElementById('collapse-icon-' + title);
  if (collapseIcon) {
    collapseIcon.className = 'icon closed';
  }
  // handle panelEle
  const panelEle = document.getElementById('panel-' + title);
  if (panelEle) {
    panelEle.className = 'aside-panel-hidden';
  }
}

mobileAside.onclick = function(e) {
  const targetId = e.target.id;
  if (targetId && (targetId.indexOf('title-') > -1 || targetId.indexOf('collapse-icon-') > -1)) {
    const title = targetId.replace('title-', '').replace('collapse-icon-', '');
    try { 
      // the the browser may have no localStroage or JSON.parse may throw exception.
      const menuInfo = JSON.parse(window.localStorage.getItem('menuInfo'));
        
      // current menu status
      const curClosed = menuInfo[title] ? menuInfo[title].closed : false; // default false

      // change UI
      curClosed ? expandMenu(title) : collapseMenu(title);

      // save menuInfo to localStorage
      menuInfo[title] = { closed: !curClosed } // opposite
      window.localStorage.setItem('menuInfo', JSON.stringify(menuInfo));
    } catch (e) {}
  }
};

mobileTrigger.onclick = function(e) {
  e.preventDefault();
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};

(function() {
  // save data to localStorage because the page will refresh when user change the url.
  let menuInfo;
  try { 
    // the the browser may have no localStroage or JSON.parse may throw exception.
    menuInfo = JSON.parse(window.localStorage.getItem('menuInfo'));
    if (!menuInfo) {
      menuInfo = {};
      window.localStorage.setItem('menuInfo', JSON.stringify(menuInfo));
    }
  } catch (e) {
    menuInfo = {}; // default {}
  }

  for (const title in menuInfo) {
    if (menuInfo[title] && menuInfo[title].closed) { // menu in closed status.
      collapseMenu(title);
    } else {
      expandMenu(title);
    }
  }

  // highlight menu
  const pathname = window.location.pathname;
  const selector = `a[href="${pathname}"].menu-link,a[href="${pathname}index.html"].menu-link`;
  const menuItem = mobileAside.querySelector(selector);
  if (menuItem) { menuItem.className += ' highlight'; }
})();
</script>

</div>

  </div>
</body>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script>
docsearch({
  apiKey: '1561de31a86f79507ea00cdb54ce647c',
  indexName: 'eggjs',
  inputSelector: '#search-query',
});
</script>
<div class="cnzz">
<script src="https://s11.cnzz.com/z_stat.php?id=1261142226&web_id=1261142226" language="JavaScript"></script>
</div>

</html>
