<!DOCTYPE html>
<html lang="en">
<head>
  <title>Deployment - Born to build better enterprise frameworks and apps</title>
  <meta charset="utf-8">
  <meta name="description" content="index.description">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="icon" href="/images/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/" class="nav-logo leftpadding" alt="egg"><img src="https://zos.alipayobjects.com/rmsportal/VTcUYAaoKqXyHJbLAPyF.svg"></a>
    <ul class="nav-item">
      <li>
        <form id="search-form">
          <input type="text" id="search-query" class="search-query st-default-search-input">
        </form>
      </li>
      <li><a href="intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li>
      <!--
      <li class="translations">
        <a class="nav-link">Translations</a>
        <span class="arrow"></span>
        <ul class="dropdown-content">
          <li><a href="/">中文</a></li>
          <li><a href="/">English</a></li>
        </ul>
      </li>
      -->
      <li><iframe src="https://ghbtns.com/github-btn.html?user=eggjs&repo=egg&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container" class="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>Deployment</h1>
    <p>Launching application via <code>egg-bin dev</code> will bring something magical to help people to develop in high efficiency. However, actually, those features are not required in production or any other environment. Let's walk through and learn how to deploy your application in Egg's way.</p>
<p>There are two steps to achieve building once and deploying multiply from source code to runtime.</p>
<h2 id="build"><a class="markdown-anchor" href="#build">#</a> Build</h2>
<p>In the stage, you don't need to compile JavaScript files unless TypeScript or Babel(ES6 features) are involved in stack.</p>
<p>Generally, before deploying the application, dependencies will be installed with <code>NODE_ENV=production</code> or <code>--production</code>, which will exclude <code>devDependencies</code> because those used in development may increase the size of package released or even create pitfalls that you never expect.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> baseDir</div><div class="line">$ npm install --production</div><div class="line">$ tar -zcvf ../release.tgz .</div></pre></td></tr></table></figure>
<p>Both the application and dependencies will be packed into a tgz file, what you are going to do is unzipping and launching it.</p>
<p>Reusable package brings a few pros in:</p>
<ul>
<li>Environments in building and runtime are different, try to keep the later environment pure and stable.</li>
<li>Abbreviating publish progress and making rollback without hassle.</li>
</ul>
<h2 id="deploy"><a class="markdown-anchor" href="#deploy">#</a> Deploy</h2>
<p>Node.js(<code>&gt;= 6.0.0</code>) is required so that you should make sure it is pre-installed in runtime environment.</p>
<p>Egg takes <code>egg-cluster</code> to create <a href="https://github.com/eggjs/egg/blob/master/docs/source/en/core/cluster-and-ipc.md#master" target="_blank" rel="external">Master</a> process, which you can rely on to secure the application instead of daemon manager like <a href="https://github.com/Unitech/pm2" target="_blank" rel="external">pm2</a>. The API is also really convenient for developers to achieve that, just <code>egg.startCluster</code>.</p>
<p>More about <a href="https://github.com/eggjs/egg-cluster#options" target="_blank" rel="external">egg-cluster</a></p>
<h3 id="dispatch-file"><a class="markdown-anchor" href="#dispatch-file">#</a> Dispatch file</h3>
<p>Create a new dispatch file in the root directory, for instance <code>dispatch.js</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// dispatch.js</span></div><div class="line"><span class="keyword">const</span> egg = <span class="built_in">require</span>(<span class="string">'egg'</span>);</div><div class="line"></div><div class="line">egg.startCluster(&#123;</div><div class="line">  <span class="attr">baseDir</span>: __dirname,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="dispatch-in-background"><a class="markdown-anchor" href="#dispatch-in-background">#</a> Dispatch in background</h3>
<p>Once you create dispatch file, you can launch the application and redirect standard output to <code>stdout.log</code> as well as error details to <code>stderr.log</code>, which are really useful for debugging later.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ EGG_SERVER_ENV=prod nohup node dispatch.js &gt; stdout.log 2&gt; stderr.log &amp;</div></pre></td></tr></table></figure>
<p>IMPORTANT:</p>
<ul>
<li><code>EGG_SERVER_ENV</code> in production must be <code>prod</code>, for more information about <a href="https://github.com/eggjs/egg/blob/master/docs/source/en/basics/env.md" target="_blank" rel="external">runtime environment</a>.</li>
<li>Launching directly when the application run in docker instance.</li>
<li>Egg usually initialize instances as many as cores, which can leverage the capability of the cpu.</li>
</ul>
<h3 id="dispatch-with-arguments"><a class="markdown-anchor" href="#dispatch-with-arguments">#</a> Dispatch with arguments</h3>
<p>Arguments of dispatch can be configured in <code>config.{env}.js</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// config/config.default.js</span></div><div class="line">exports.cluster = &#123;</div><div class="line">  <span class="attr">listen</span>: &#123;</div><div class="line">    <span class="attr">port</span>: <span class="string">'7001'</span>,</div><div class="line">    <span class="attr">hostname</span>: <span class="string">'127.0.0.1'</span>,</div><div class="line">    <span class="comment">// path: '/var/run/egg.sock',</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback" target="_blank" rel="external">server.listen</a> supports arguments including <code>path</code>, <code>port</code> and <code>hostname</code> to change dispatching behavior. One thing you should know is that the <code>port</code> in <code>egg.startCluster</code> will override the one in application config.</p>
<h3 id="dispatch-from-extended-framework"><a class="markdown-anchor" href="#dispatch-from-extended-framework">#</a> Dispatch from extended framework</h3>
<p>What about dispatch from your framework extended from <a href="https://github.com/eggjs/egg/blob/master/docs/source/en/advanced/framework.md" target="_blank" rel="external">Egg's Application</a> like <code>yadan</code>? Egg offers <code>customEgg</code> to change the entry:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// dispatch.js</span></div><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">const</span> egg = <span class="built_in">require</span>(<span class="string">'egg'</span>);</div><div class="line"></div><div class="line">egg.startCluster(&#123;</div><div class="line">  <span class="attr">baseDir</span>: __dirname,</div><div class="line">  <span class="attr">customEgg</span>: path.join(__dirname, <span class="string">'node_modules/yadan'</span>),</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="intro/" alt="Guide">Guide</a></li><li><a href="/api/" alt="API">API</a></li><li><a href="tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li></ul>
  </div>
  <dl><dt>Guide</dt><dd><ul><li><a href="/en/intro/index.html">What is Egg?</a></li><li><a href="/en/intro/egg-and-koa.html">Egg and Koa</a></li><li><a href="/en/intro/quickstart.html">Quick Start</a></li></ul></dd><dt>Basis Function</dt><dd><ul><li><a href="/en/basics/structure.html">Directory Structure</a></li><li><a href="/en/basics/objects.html">Built-in Objects</a></li><li><a href="/en/basics/env.html">Environment</a></li><li><a href="/en/basics/config.html">Configuration</a></li><li><a href="/en/basics/middleware.html">Middleware</a></li><li><a href="/en/basics/router.html">Router</a></li><li><a href="/en/basics/controller.html">Controller</a></li><li><a href="/en/basics/service.html">Service</a></li><li><a href="/en/basics/schedule.html">Schedule</a></li><li><a href="/en/basics/extend.html">Extend</a></li><li><a href="/en/basics/app-start.html">Custom Init</a></li></ul></dd><dt>Core</dt><dd><ul><li><a href="/en/core/development.html">Development</a></li><li><a href="/en/core/unittest.html">Unit Testing</a></li><li><a href="/en/core/deployment.html">应用部署</a></li><li><a href="/en/core/logger.html">Logger</a></li><li><a href="/en/core/httpclient.html">HttpClient</a></li><li><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li><a href="/en/core/view.html">View</a></li><li><a href="/en/core/error-handling.html">Error Handling</a></li><li><a href="/en/core/security.html">Security</a></li><li><a href="/en/core/i18n.html">i18n</a></li></ul></dd><dt>Tutorials</dt><dd><ul><li><a href="/en/tutorials/progressive.html">Progressive</a></li><li><a href="/en/tutorials/mysql.html">MySQL</a></li><li><a href="/en/tutorials/restful.html">RESTful API</a></li><li><a href="/en/tutorials/async-function.html">Async Function</a></li></ul></dd><dt>Advanced</dt><dd><ul><li><a href="/en/advanced/loader.html">Loader</a></li><li><a href="/en/advanced/plugin.html">Plugin</a></li><li><a href="/en/advanced/framework.html">Framework</a></li><li><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li><a href="/en/advanced/view-plugin.html">View Plugin</a></li></ul></dd><dt>Community</dt><dd><ul><li><a href="/en/plugins/">内置插件列表</a></li><li><a href="/en/contributing.html">Contributing</a></li><li><a href="/en/resource.html">资源</a></li><li><a href="/en/faq.html">FAQ</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script>
docsearch({
  apiKey: '1561de31a86f79507ea00cdb54ce647c',
  indexName: 'eggjs',
  inputSelector: '#search-query',
});
</script>
<div class="cnzz">
<script src="https://s11.cnzz.com/z_stat.php?id=1261142226&web_id=1261142226" language="JavaScript"></script>
</div>

</html>
